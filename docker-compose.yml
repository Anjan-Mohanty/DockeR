version: '3'



services:


    website:
        build: ./Website
        volumes:
            - ./Website:/usr/app/
            - ./Objects:/usr/app/Objects
        ports:
            - '80:8501'
        links:
            - usermaker
        depends_on:
            - mongodb
        networks:
            - discover_weekly_twitter
            
            
    mongodb:
        image: mongo:latest
        environment:
            MONGO_INITDB_ROOT_USERNAME: mongo
            MONGO_INITDB_ROOT_PASSWORD: password
        volumes:
            - MongoDb:/data/db
        ports:
            - '28017:27017'
        networks:
            - discover_weekly_twitter
            
            
    usermaker:
        build: ./UserMaker
        volumes:
            - ./UserMaker:/app
            - ./Objects:/app/Objects
        ports:
            - '5000:5000'
        depends_on:
            - mongodb
        networks:
            - discover_weekly_twitter
            
            
    datacollection: &datacollection
        build: ./DataCollection
        volumes:
            - ./DataCollection:/app
            - ./Objects:/app/Objects
        ports:
            - '5010:5010'
        depends_on:
            - celeryworker
            - rabbitmq
        networks:
            - discover_weekly_twitter
            
            
    rabbitmq:
        image: rabbitmq:3.8.9
        environment:
            - RABBITMQ_DEFAULT_USER=myuser
            - RABBITMQ_DEFAULT_PASS=mypassword
        ports:
            - '5672:5672'
        networks:
            - discover_weekly_twitter
            
    
    celeryworker:
        <<: *datacollection
        command: celery -A app.celery worker --concurrency=5 --loglevel=INFO
        ports: []
        depends_on:
            - rabbitmq
        deploy:
            mode: replicated
            replicas: 2
            
            
    scheduler:
        build: ./Scheduler
        volumes:
            - ./Scheduler:/app
            - ./Objects:/app/Objects
        ports:
            - '5020:5020'
        networks:
            - discover_weekly_twitter
    
    discoverusers:
        build: ./DiscoverUsers
        volumes:
            - ./DiscoverUsers:/app
            - ./Objects:/app/Objects
        ports:
            - '5030:5030'
        networks:
            - discover_weekly_twitter
    
    muteusers:
        build: ./MuteUsers
        volumes:
            - ./MuteUsers:/app
            - ./Objects:/app/Objects
        ports:
            - '5040:5040'
        networks:
            - discover_weekly_twitter
            
        
networks:
    discover_weekly_twitter:
        driver: bridge

volumes:
    MongoDb: